# MDS Caddyfile - Reverse Proxy f√ºr Frontend + Backend API
:80 {
  # Static Frontend
  root * /srv/frontend
  encode zstd gzip

  # Caching: Assets lange cachen, HTML nie
  @assets {
    path *.js *.css *.png *.jpg *.jpeg *.gif *.svg *.ico *.webp *.woff *.woff2
  }
  header @assets Cache-Control "public, max-age=31536000, immutable"

  @html {
    path / /index.html
    path_regexp html ^/(?:$|.*\.html)$
  }
  header @html Cache-Control "no-store"

  # API Proxy zu Backend
  handle /api/* {
    reverse_proxy backend:5000 {
      flush_interval -1
      transport http {
        keepalive 30s
      }
    }
  }

  # SPA Fallback
  handle {
    try_files {path} /index.html
    file_server
  }
}
